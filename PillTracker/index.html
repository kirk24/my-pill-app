<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒè¯æ‰“å¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 540px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 600;
        }

        .streak-badge {
            margin: 10px auto 25px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 14px 26px;
            border-radius: 999px;
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(255, 126, 95, 0.35);
            animation: breathe 2.6s ease-in-out infinite;
        }

        .streak-icon {
            font-size: 22px;
        }

        .streak-count {
            font-size: 20px;
        }

        @keyframes breathe {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.04);
            }
        }

        .date {
            color: #666;
            font-size: 16px;
            margin-bottom: 40px;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .status-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .status-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }

        .check-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            width: 100%;
            margin-bottom: 20px;
        }

        .check-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .check-btn:active {
            transform: translateY(0);
        }

        .check-btn.checked {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .check-btn.checked:hover {
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.5);
        }

        .calendar {
            margin-top: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .calendar-legend {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: #888;
        }

        .calendar-legend-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .legend-dot.taken {
            background: #38ef7d;
        }

        .legend-dot.empty {
            background: #e0e0e0;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 6px;
            font-size: 12px;
            color: #999;
        }

        .calendar-weekdays span {
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .calendar-day {
            height: 34px;
            border-radius: 10px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .calendar-day--empty {
            background: #e9ecef;
            color: #999;
        }

        .calendar-day--taken {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(56, 239, 125, 0.4);
        }

        .calendar-day--today {
            outline: 2px solid #667eea;
            outline-offset: -2px;
            font-weight: 700;
        }

        .calendar-day--placeholder {
            background: transparent;
        }

        .history {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e0e0e0;
        }

        .history-title {
            color: #333;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .history-list {
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .history-date {
            color: #666;
            font-size: 14px;
        }

        .history-status {
            font-size: 14px;
            font-weight: 600;
        }

        .history-status.checked {
            color: #38ef7d;
        }

        .history-status.unchecked {
            color: #999;
        }

        .clear-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #ff5252;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’Š åƒè¯æ‰“å¡</h1>
        <div class="streak-badge">
            <span class="streak-icon">ğŸ”¥</span>
            <span>è¿ç»­æ‰“å¡ <span class="streak-count" id="streakCount">0</span> å¤©</span>
        </div>
        <div class="date" id="currentDate"></div>
        
        <div class="status-card">
            <div class="status-icon" id="statusIcon">ğŸ˜´</div>
            <div class="status-text" id="statusText">ä»Šå¤©è¿˜æ²¡æœ‰æ‰“å¡</div>
            <button class="check-btn" id="checkBtn">ç‚¹å‡»æ‰“å¡</button>
        </div>

        <div class="calendar">
            <div class="calendar-header">
                <span id="calendarMonthLabel"></span>
                <div class="calendar-legend">
                    <span class="calendar-legend-item">
                        <span class="legend-dot taken"></span> å·²è®°å½•
                    </span>
                    <span class="calendar-legend-item">
                        <span class="legend-dot empty"></span> æ— è®°å½•
                    </span>
                </div>
            </div>
            <div class="calendar-weekdays">
                <span>æ—¥</span>
                <span>ä¸€</span>
                <span>äºŒ</span>
                <span>ä¸‰</span>
                <span>å››</span>
                <span>äº”</span>
                <span>å…­</span>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <div class="history">
            <div class="history-title">ğŸ“… æ‰“å¡è®°å½•</div>
            <div class="history-list" id="historyList"></div>
            <button class="clear-btn" id="clearBtn">æ¸…ç©ºè®°å½•</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // è·å–å½“å‰æ—¥æœŸå­—ç¬¦ä¸² (YYYY-MM-DD)
        function getTodayString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getDateString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDate(dateString) {
            const date = new Date(dateString);
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekday = weekdays[date.getDay()];
            return `${month}æœˆ${day}æ—¥ ${weekday}`;
        }

        // ä» LocalStorage è·å–æ•°æ®
        function getData() {
            const data = localStorage.getItem('pillTracker');
            return data ? JSON.parse(data) : {};
        }

        // ä¿å­˜æ•°æ®åˆ° LocalStorage
        function saveData(data) {
            localStorage.setItem('pillTracker', JSON.stringify(data));
        }

        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æ‰“å¡
        function checkTodayStatus() {
            const data = getData();
            const today = getTodayString();
            return data[today] === true;
        }

        // æ‰“å¡
        function checkIn() {
            const data = getData();
            const today = getTodayString();
            data[today] = true;
            saveData(data);
            triggerConfetti();
            updateUI();
        }

        // å–æ¶ˆæ‰“å¡
        function checkOut() {
            const data = getData();
            const today = getTodayString();
            data[today] = false;
            saveData(data);
            updateUI();
        }

        // è·å–å½“æœˆä¿¡æ¯
        function getCurrentMonthInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const monthIndex = today.getMonth(); // 0-11
            const firstDay = new Date(year, monthIndex, 1);
            const firstWeekday = firstDay.getDay(); // 0-6, 0 æ˜¯å‘¨æ—¥
            const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

            return { year, monthIndex, firstWeekday, daysInMonth };
        }

        // æ¸²æŸ“å½“æœˆæ—¥å†
        function renderCalendar() {
            const { year, monthIndex, firstWeekday, daysInMonth } = getCurrentMonthInfo();
            const data = getData();
            const calendarGrid = document.getElementById('calendarGrid');
            const monthLabel = document.getElementById('calendarMonthLabel');
            const todayStr = getTodayString();

            monthLabel.textContent = `${year}å¹´${String(monthIndex + 1).padStart(2, '0')}æœˆ`;
            calendarGrid.innerHTML = '';

            // å ä½ç©ºç™½æ ¼ï¼ˆæœ¬æœˆç¬¬ä¸€å¤©å‰çš„ç©ºä½ï¼‰
            for (let i = 0; i < firstWeekday; i++) {
                const placeholder = document.createElement('div');
                placeholder.className = 'calendar-day calendar-day--placeholder';
                calendarGrid.appendChild(placeholder);
            }

            // æ¸²æŸ“æ¯ä¸€å¤©
            for (let day = 1; day <= daysInMonth; day++) {
                const month = String(monthIndex + 1).padStart(2, '0');
                const dayStr = String(day).padStart(2, '0');
                const dateKey = `${year}-${month}-${dayStr}`;
                const hasRecord = Object.prototype.hasOwnProperty.call(data, dateKey);

                const cell = document.createElement('div');
                cell.textContent = day;
                cell.classList.add('calendar-day');

                if (hasRecord) {
                    // æœ‰è®°å½•ï¼šç»¿è‰²èƒŒæ™¯
                    cell.classList.add('calendar-day--taken');
                } else {
                    // æ— è®°å½•ï¼šç°è‰²èƒŒæ™¯
                    cell.classList.add('calendar-day--empty');
                }

                if (dateKey === todayStr) {
                    cell.classList.add('calendar-day--today');
                }

                calendarGrid.appendChild(cell);
            }
        }

        // è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°
        function calculateStreak() {
            const data = getData();
            const today = new Date();
            const todayKey = getTodayString();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            let streak = 0;
            let cursor = new Date(yesterday);

            while (true) {
                const key = getDateString(cursor);
                if (data[key]) {
                    streak += 1;
                    cursor.setDate(cursor.getDate() - 1);
                } else {
                    break;
                }
            }

            if (data[todayKey]) {
                streak += 1;
            }

            return streak;
        }

        function updateStreakBadge() {
            const streak = calculateStreak();
            document.getElementById('streakCount').textContent = streak;
        }

        function triggerConfetti() {
            if (typeof confetti !== 'function') return;
            confetti({
                particleCount: 120,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // æ›´æ–°ç•Œé¢
        function updateUI() {
            const today = getTodayString();
            const isChecked = checkTodayStatus();
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            const checkBtn = document.getElementById('checkBtn');

            if (isChecked) {
                statusIcon.textContent = 'âœ…';
                statusText.textContent = 'ä»Šå¤©å·²æ‰“å¡ï¼';
                checkBtn.textContent = 'å–æ¶ˆæ‰“å¡';
                checkBtn.classList.add('checked');
            } else {
                statusIcon.textContent = 'ğŸ˜´';
                statusText.textContent = 'ä»Šå¤©è¿˜æ²¡æœ‰æ‰“å¡';
                checkBtn.textContent = 'ç‚¹å‡»æ‰“å¡';
                checkBtn.classList.remove('checked');
            }

            updateHistory();
            renderCalendar();
            updateStreakBadge();
        }

        // æ›´æ–°å†å²è®°å½•
        function updateHistory() {
            const data = getData();
            const historyList = document.getElementById('historyList');
            const today = getTodayString();

            // è·å–æ‰€æœ‰æ—¥æœŸå¹¶æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const dates = Object.keys(data).sort((a, b) => b.localeCompare(a));

            if (dates.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— è®°å½•</div>';
                return;
            }

            historyList.innerHTML = dates.map(date => {
                const isChecked = data[date] === true;
                const isToday = date === today;
                return `
                    <div class="history-item">
                        <span class="history-date">${formatDate(date)}${isToday ? ' (ä»Šå¤©)' : ''}</span>
                        <span class="history-status ${isChecked ? 'checked' : 'unchecked'}">
                            ${isChecked ? 'âœ“ å·²æ‰“å¡' : 'â—‹ æœªæ‰“å¡'}
                        </span>
                    </div>
                `;
            }).join('');
        }

        // æ¸…ç©ºè®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰“å¡è®°å½•å—ï¼Ÿ')) {
                localStorage.removeItem('pillTracker');
                updateUI();
            }
        }

        // åˆå§‹åŒ–
        function init() {
            // æ˜¾ç¤ºå½“å‰æ—¥æœŸ
            document.getElementById('currentDate').textContent = formatDate(getTodayString());

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('checkBtn').addEventListener('click', () => {
                if (checkTodayStatus()) {
                    checkOut();
                } else {
                    checkIn();
                }
            });

            document.getElementById('clearBtn').addEventListener('click', clearHistory);

            // æ›´æ–°ç•Œé¢
            updateUI();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
